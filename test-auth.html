<!DOCTYPE html>
<html>
<head>
    <title>–§–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç Supabase</title>
    <style>
        body { 
            background: #0a0a0f; 
            color: white; 
            font-family: monospace; 
            padding: 20px; 
            margin: 0;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .success { color: #2ed573; }
        .error { color: #ff4757; }
        .info { color: #4a6fa5; }
        pre { 
            background: #1a1a2e; 
            padding: 10px; 
            border-radius: 5px;
            overflow-x: auto;
        }
        button { 
            background: linear-gradient(135deg, #ff4757, #8a6bff);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            font-weight: bold;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(255,71,87,0.4);
        }
        input {
            background: #1a1a2e;
            border: 2px solid #2d2d4d;
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            margin: 5px;
            width: 250px;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        input:focus {
            outline: none;
            border-color: #ff4757;
            box-shadow: 0 0 0 3px rgba(255,71,87,0.2);
        }
        .card {
            background: #111122;
            border: 2px solid #2d2d4d;
            border-radius: 12px;
            padding: 25px;
            margin: 25px 0;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }
        .card h3 {
            margin-top: 0;
            color: #8a6bff;
            border-bottom: 2px solid #2d2d4d;
            padding-bottom: 10px;
        }
        #result {
            background: #1a1a2e;
            border: 2px solid #2d2d4d;
            border-radius: 8px;
            padding: 20px;
            min-height: 150px;
            max-height: 400px;
            overflow-y: auto;
            font-family: monospace;
            line-height: 1.6;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            font-size: 2.5em;
            background: linear-gradient(135deg, #ff4757, #8a6bff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ –§–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç Supabase</h1>
            <p style="color: #b0b0cc;">–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö</p>
        </div>
        
        <div class="card">
            <h3>üîå –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</h3>
            <button id="btnTestConnection">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</button>
            <button id="btnClear">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
        </div>
        
        <div class="card">
            <h3>üìù –®–∞–≥ 2: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h3>
            <input type="email" id="regEmail" placeholder="Email" value="test@example.com">
            <input type="password" id="regPassword" placeholder="–ü–∞—Ä–æ–ª—å" value="test123456">
            <input type="text" id="regUsername" placeholder="Username" value="testuser">
            <button id="btnRegister">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
        </div>
        
        <div class="card">
            <h3>üîë –®–∞–≥ 3: –í—Ö–æ–¥</h3>
            <input type="email" id="loginEmail" placeholder="Email" value="test@example.com">
            <input type="password" id="loginPassword" placeholder="–ü–∞—Ä–æ–ª—å" value="test123456">
            <button id="btnLogin">–í–æ–π—Ç–∏</button>
        </div>
        
        <div class="card">
            <h3>üë§ –®–∞–≥ 4: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ</h3>
            <button id="btnCheckUser">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
            <button id="btnLogout">–í—ã–π—Ç–∏</button>
        </div>
        
        <div class="card">
            <h3>üìã –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:</h3>
            <div id="result"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞
        const SUPABASE_CLIENT = (function() {
            const SUPABASE_URL = 'https://kegcpzeulrbarwyglcsq.supabase.co';
            const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtlZ2NwemV1bHJiYXJ3eWdsY3NxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE1OTMzMTEsImV4cCI6MjA4NzE2OTMxMX0.sAQzdqQ1cFhPITd7yC6pDHIj_vIYxX6CLxQ-UPPxm4g';
            
            return window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        })();

        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const resultDiv = document.getElementById('result');

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
        function addLog(message, type = 'info') {
            const color = type === 'success' ? '#2ed573' : 
                         type === 'error' ? '#ff4757' : '#4a6fa5';
            const time = new Date().toLocaleTimeString();
            resultDiv.innerHTML += `<div style="color: ${color}; margin: 8px 0; border-left: 3px solid ${color}; padding-left: 10px;">[${time}] ${message}</div>`;
            resultDiv.scrollTop = resultDiv.scrollHeight;
        }

        function clearLog() {
            resultDiv.innerHTML = '';
            addLog('üîÑ –õ–æ–≥ –æ—á–∏—â–µ–Ω', 'info');
        }

        // –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            // –ö–Ω–æ–ø–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
            document.getElementById('btnTestConnection').addEventListener('click', async function() {
                clearLog();
                addLog('üîÑ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Supabase...');
                
                try {
                    const { data, error } = await SUPABASE_CLIENT
                        .from('demons')
                        .select('count', { count: 'exact', head: true });
                    
                    if (error) {
                        addLog(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
                        if (error.message.includes('relation') && error.message.includes('does not exist')) {
                            addLog('üí° –¢–∞–±–ª–∏—Ü–∞ "demons" –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç! –°–æ–∑–¥–∞–π—Ç–µ –µ—ë —á–µ—Ä–µ–∑ SQL Editor:', 'info');
                            addLog(`<pre>
CREATE TABLE demons (
    id SERIAL PRIMARY KEY,
    name TEXT NOT NULL,
    creator TEXT NOT NULL,
    position INTEGER,
    tags TEXT[] DEFAULT '{}',
    points INTEGER DEFAULT 0,
    video TEXT
);</pre>`, 'info');
                        }
                    } else {
                        addLog('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Supabase —É—Å–ø–µ—à–Ω–æ!', 'success');
                        addLog('üîÑ –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã demons...');
                        
                        const { data: demons, error: demonsError } = await SUPABASE_CLIENT
                            .from('demons')
                            .select('*')
                            .limit(3);
                        
                        if (demonsError) {
                            addLog(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö: ${demonsError.message}`, 'error');
                        } else {
                            addLog(`‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã! –ù–∞–π–¥–µ–Ω–æ –¥–µ–º–æ–Ω–æ–≤: ${demons.length}`, 'success');
                            if (demons.length > 0) {
                                addLog('<pre>' + JSON.stringify(demons, null, 2) + '</pre>');
                            }
                        }
                    }
                } catch (err) {
                    addLog(`‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: ${err.message}`, 'error');
                }
            });

            // –ö–Ω–æ–ø–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
            document.getElementById('btnRegister').addEventListener('click', async function() {
                clearLog();
                const email = document.getElementById('regEmail').value;
                const password = document.getElementById('regPassword').value;
                const username = document.getElementById('regUsername').value;
                
                addLog(`üîÑ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è: ${email}`);
                
                try {
                    // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ Auth
                    const { data, error } = await SUPABASE_CLIENT.auth.signUp({
                        email: email,
                        password: password,
                        options: {
                            data: {
                                username: username
                            }
                        }
                    });
                    
                    if (error) {
                        addLog(`‚ùå –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ${error.message}`, 'error');
                        return;
                    }
                    
                    addLog('‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ Auth —É—Å–ø–µ—à–Ω–∞!', 'success');
                    addLog(`üë§ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${data.user.id}`, 'info');
                    
                    // –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –≤ —Ç–∞–±–ª–∏—Ü–µ users
                    addLog('üîÑ –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –≤ —Ç–∞–±–ª–∏—Ü–µ users...');
                    
                    const { error: insertError } = await SUPABASE_CLIENT
                        .from('users')
                        .insert([
                            {
                                id: data.user.id,
                                username: username,
                                email: email,
                                points: 0,
                                rank: '–ù–æ–≤–∏—á–æ–∫',
                                completed_demons: []
                            }
                        ]);
                    
                    if (insertError) {
                        if (insertError.message.includes('duplicate key')) {
                            addLog('‚ÑπÔ∏è –ü—Ä–æ—Ñ–∏–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç', 'info');
                        } else {
                            addLog(`‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è: ${insertError.message}`, 'error');
                        }
                    } else {
                        addLog('‚úÖ –ü—Ä–æ—Ñ–∏–ª—å —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!', 'success');
                    }
                    
                } catch (err) {
                    addLog(`‚ùå –û—à–∏–±–∫–∞: ${err.message}`, 'error');
                }
            });

            // –ö–Ω–æ–ø–∫–∞ –≤—Ö–æ–¥–∞
            document.getElementById('btnLogin').addEventListener('click', async function() {
                clearLog();
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                
                addLog(`üîÑ –í—Ö–æ–¥: ${email}`);
                
                try {
                    const { data, error } = await SUPABASE_CLIENT.auth.signInWithPassword({
                        email: email,
                        password: password
                    });
                    
                    if (error) {
                        addLog(`‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ${error.message}`, 'error');
                        return;
                    }
                    
                    addLog('‚úÖ –í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!', 'success');
                    addLog(`üë§ Email: ${data.user.email}`, 'info');
                    
                    // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã users
                    const { data: userData, error: userError } = await SUPABASE_CLIENT
                        .from('users')
                        .select('*')
                        .eq('id', data.user.id)
                        .single();
                    
                    if (userError) {
                        addLog(`‚ö†Ô∏è –ü—Ä–æ—Ñ–∏–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω: ${userError.message}`, 'error');
                    } else {
                        addLog(`üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: ${userData.points} –æ—á–∫–æ–≤, —Ä–∞–Ω–≥: ${userData.rank}`, 'success');
                        addLog(`üë§ –ò–º—è: ${userData.username}`, 'info');
                    }
                    
                } catch (err) {
                    addLog(`‚ùå –û—à–∏–±–∫–∞: ${err.message}`, 'error');
                }
            });

            // –ö–Ω–æ–ø–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            document.getElementById('btnCheckUser').addEventListener('click', async function() {
                clearLog();
                
                try {
                    const { data: { user }, error } = await SUPABASE_CLIENT.auth.getUser();
                    
                    if (error) {
                        addLog(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
                    } else if (user) {
                        addLog('‚úÖ –¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:', 'success');
                        addLog(`üë§ Email: ${user.email}`, 'info');
                        addLog(`üÜî ID: ${user.id}`, 'info');
                        
                        const { data: userData, error: userError } = await SUPABASE_CLIENT
                            .from('users')
                            .select('*')
                            .eq('id', user.id)
                            .single();
                        
                        if (userError) {
                            addLog(`‚ö†Ô∏è –ü—Ä–æ—Ñ–∏–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω: ${userError.message}`, 'error');
                        } else {
                            addLog('üìä –î–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è:', 'success');
                            addLog(`–ò–º—è: ${userData.username}`, 'info');
                            addLog(`–û—á–∫–∏: ${userData.points}`, 'info');
                            addLog(`–†–∞–Ω–≥: ${userData.rank}`, 'info');
                        }
                    } else {
                        addLog('üë§ –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π —Å–µ—Å—Å–∏–∏', 'info');
                    }
                } catch (err) {
                    addLog(`‚ùå –û—à–∏–±–∫–∞: ${err.message}`, 'error');
                }
            });

            // –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞
            document.getElementById('btnLogout').addEventListener('click', async function() {
                clearLog();
                
                try {
                    const { error } = await SUPABASE_CLIENT.auth.signOut();
                    
                    if (error) {
                        addLog(`‚ùå –û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞: ${error.message}`, 'error');
                    } else {
                        addLog('‚úÖ –í—ã—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ', 'success');
                    }
                } catch (err) {
                    addLog(`‚ùå –û—à–∏–±–∫–∞: ${err.message}`, 'error');
                }
            });

            // –ö–Ω–æ–ø–∫–∞ –æ—á–∏—Å—Ç–∫–∏
            document.getElementById('btnClear').addEventListener('click', clearLog);

            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            addLog('üîÑ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ù–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ"', 'info');
        });
    </script>
</body>
</html>

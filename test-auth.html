<!DOCTYPE html>
<html>
<head>
    <title>–¢–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ Supabase</title>
    <style>
        body { background: #0a0a0f; color: white; font-family: monospace; padding: 20px; }
        .success { color: #2ed573; }
        .error { color: #ff4757; }
        .info { color: #4a6fa5; }
        pre { background: #1a1a2e; padding: 10px; border-radius: 5px; }
        button { 
            background: linear-gradient(135deg, #ff4757, #8a6bff);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        input {
            background: #1a1a2e;
            border: 2px solid #2d2d4d;
            color: white;
            padding: 8px;
            border-radius: 5px;
            margin: 5px;
            width: 250px;
        }
    </style>
</head>
<body>
    <h1>üîê –¢–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ Supabase</h1>
    
    <div style="margin: 20px 0;">
        <h3>üìù –¢–µ—Å—Ç–æ–≤–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h3>
        <input type="email" id="regEmail" placeholder="Email" value="test@example.com">
        <input type="password" id="regPassword" placeholder="–ü–∞—Ä–æ–ª—å" value="test123456">
        <input type="text" id="regUsername" placeholder="Username" value="testuser">
        <button onclick="testRegister()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
    </div>
    
    <div style="margin: 20px 0;">
        <h3>üîë –¢–µ—Å—Ç–æ–≤—ã–π –≤—Ö–æ–¥</h3>
        <input type="email" id="loginEmail" placeholder="Email" value="test@example.com">
        <input type="password" id="loginPassword" placeholder="–ü–∞—Ä–æ–ª—å" value="test123456">
        <button onclick="testLogin()">–í–æ–π—Ç–∏</button>
    </div>
    
    <div style="margin: 20px 0;">
        <button onclick="testConnection()">üîå –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</button>
        <button onclick="checkUser()">üë§ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
        <button onclick="logout()">üö™ –í—ã–π—Ç–∏</button>
    </div>
    
    <div id="result" style="margin-top: 20px;"></div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Supabase
        const SUPABASE_URL = 'https://kegcpzeulrbarwyglcsq.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtlZ2NwemV1bHJiYXJ3eWdsY3NxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE1OTMzMTEsImV4cCI6MjA4NzE2OTMxMX0.sAQzdqQ1cFhPITd7yC6pDHIj_vIYxX6CLxQ-UPPxm4g';
        
        // –°–æ–∑–¥–∞–µ–º –∫–ª–∏–µ–Ω—Ç
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        const resultDiv = document.getElementById('result');

        function log(message, type = 'info') {
            const color = type === 'success' ? '#2ed573' : 
                         type === 'error' ? '#ff4757' : '#4a6fa5';
            resultDiv.innerHTML += `<p style="color: ${color}">${message}</p>`;
        }

        function clearLog() {
            resultDiv.innerHTML = '';
        }

        async function testConnection() {
            clearLog();
            log('üîÑ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...');
            
            try {
                const { data, error } = await supabase
                    .from('demons')
                    .select('count', { count: 'exact', head: true });
                
                if (error) {
                    log(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
                } else {
                    log('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Supabase —Ä–∞–±–æ—Ç–∞–µ—Ç!', 'success');
                }
            } catch (err) {
                log(`‚ùå –û—à–∏–±–∫–∞: ${err.message}`, 'error');
            }
        }

        async function testRegister() {
            clearLog();
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const username = document.getElementById('regUsername').value;
            
            log(`üîÑ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è: ${email}`);
            
            try {
                const { data, error } = await supabase.auth.signUp({
                    email: email,
                    password: password,
                    options: {
                        data: {
                            username: username
                        }
                    }
                });
                
                if (error) {
                    log(`‚ùå –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ${error.message}`, 'error');
                } else {
                    log('‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!', 'success');
                    log(`üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${data.user.email}`, 'info');
                    
                    // –°–æ–∑–¥–∞–µ–º –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ users
                    if (data.user) {
                        const { error: insertError } = await supabase
                            .from('users')
                            .insert([
                                {
                                    id: data.user.id,
                                    username: username,
                                    email: email,
                                    points: 0,
                                    rank: '–ù–æ–≤–∏—á–æ–∫',
                                    completed_demons: []
                                }
                            ]);
                        
                        if (insertError) {
                            log(`‚ö†Ô∏è –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è: ${insertError.message}`, 'error');
                        } else {
                            log('‚úÖ –ü—Ä–æ—Ñ–∏–ª—å —Å–æ–∑–¥–∞–Ω –≤ —Ç–∞–±–ª–∏—Ü–µ users', 'success');
                        }
                    }
                }
            } catch (err) {
                log(`‚ùå –û—à–∏–±–∫–∞: ${err.message}`, 'error');
            }
        }

        async function testLogin() {
            clearLog();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            log(`üîÑ –í—Ö–æ–¥: ${email}`);
            
            try {
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: email,
                    password: password
                });
                
                if (error) {
                    log(`‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ${error.message}`, 'error');
                } else {
                    log('‚úÖ –í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!', 'success');
                    log(`üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${data.user.email}`, 'info');
                    
                    // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã users
                    const { data: userData, error: userError } = await supabase
                        .from('users')
                        .select('*')
                        .eq('id', data.user.id)
                        .single();
                    
                    if (userError) {
                        log(`‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è: ${userError.message}`, 'error');
                    } else {
                        log(`üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: ${userData.points} –æ—á–∫–æ–≤, —Ä–∞–Ω–≥: ${userData.rank}`, 'info');
                    }
                }
            } catch (err) {
                log(`‚ùå –û—à–∏–±–∫–∞: ${err.message}`, 'error');
            }
        }

        async function checkUser() {
            clearLog();
            
            try {
                const { data: { user }, error } = await supabase.auth.getUser();
                
                if (error) {
                    log(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
                } else if (user) {
                    log('‚úÖ –¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:', 'success');
                    log(`üë§ Email: ${user.email}`, 'info');
                    log(`üÜî ID: ${user.id}`, 'info');
                    
                    // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã users
                    const { data: userData, error: userError } = await supabase
                        .from('users')
                        .select('*')
                        .eq('id', user.id)
                        .single();
                    
                    if (userError) {
                        log(`‚ö†Ô∏è –ù–µ—Ç –ø—Ä–æ—Ñ–∏–ª—è –≤ —Ç–∞–±–ª–∏—Ü–µ users: ${userError.message}`, 'error');
                    } else {
                        log(`üìä –î–∞–Ω–Ω—ã–µ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã users:`, 'success');
                        log(`–ò–º—è: ${userData.username}`, 'info');
                        log(`–û—á–∫–∏: ${userData.points}`, 'info');
                        log(`–†–∞–Ω–≥: ${userData.rank}`, 'info');
                        log(`–ü—Ä–æ–π–¥–µ–Ω–æ –¥–µ–º–æ–Ω–æ–≤: ${userData.completed_demons.length}`, 'info');
                    }
                } else {
                    log('üë§ –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π —Å–µ—Å—Å–∏–∏', 'info');
                }
            } catch (err) {
                log(`‚ùå –û—à–∏–±–∫–∞: ${err.message}`, 'error');
            }
        }

        async function logout() {
            clearLog();
            
            try {
                const { error } = await supabase.auth.signOut();
                
                if (error) {
                    log(`‚ùå –û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞: ${error.message}`, 'error');
                } else {
                    log('‚úÖ –í—ã—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ', 'success');
                }
            } catch (err) {
                log(`‚ùå –û—à–∏–±–∫–∞: ${err.message}`, 'error');
            }
        }
    </script>
</body>
</html>
